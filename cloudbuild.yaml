steps:
  - name: gcr.io/cloud-builders/bazel
    args:
      [
        "test",
        "--remote_cache=https://storage.googleapis.com/cents-ideas-bazel-cache",
        "--google_default_credentials",
        "--test_output=errors",
        "//...",
      ]

  - id: "push docker images and deploy changes to kubernetes"
    name: eu.gcr.io/cents-ideas/bazel-kubectl
    args:
      [
        "run",
        "--remote_cache=https://storage.googleapis.com/cents-ideas-bazel-cache",
        "--google_default_credentials",
        "//:kubernetes.apply",
      ]
